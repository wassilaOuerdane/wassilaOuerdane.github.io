
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>1.5. Optional features &#8212; MultiAgent Systems 2020-2021 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="I.6. Exercise Solutions" href="correction-part-2.html" />
    <link rel="prev" title="1.4. The Mesa platform for Python" href="part-3.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="correction-part-2.html" title="I.6. Exercise Solutions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="part-3.html" title="1.4. The Mesa platform for Python"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MultiAgent Systems 2020-2021 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="optional-features">
<h1>1.5. Optional features<a class="headerlink" href="#optional-features" title="Permalink to this headline">¶</a></h1>
<p>This section presents two <strong>optional</strong> features of Mesa. They will be useful in the third session of the course (not next week, but the next one). You can skip it for now and consider today’s session over. You will be able to come back to this tutorial later if required.</p>
<p>The two features are:</p>
<ul class="simple">
<li><p>Data collection</p></li>
<li><p>Interactive visualization</p></li>
</ul>
<div class="section" id="collecting-data">
<h2>1. Collecting data<a class="headerlink" href="#collecting-data" title="Permalink to this headline">¶</a></h2>
<p>Mesa provides a class which can handle data collection and storage at runtime, which avoids to manipulates tables or dictionaries manually in the model. All this is done via the <code class="docutils literal notranslate"><span class="pre">DataCollector</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mesa.datacollection</span> <span class="kn">import</span> <span class="n">DataCollector</span>
</pre></div>
</div>
<p>The data collector stores three categories of data: model-level variables, agent-level variables, and tables (which are a catch-all for everything else).</p>
<div class="section" id="agent-level">
<h3>Agent-level<a class="headerlink" href="#agent-level" title="Permalink to this headline">¶</a></h3>
<p>First, let us consider an agent-level variable. Imagine we want to store the value of each agent’s wealth at each time step. We must add in the <code class="docutils literal notranslate"><span class="pre">MoneyModel</span></code> constructor a <code class="docutils literal notranslate"><span class="pre">DataCollector</span></code> with the parameter <code class="docutils literal notranslate"><span class="pre">agent_reporters</span></code> set to a dictionary that associates the label of the data and the name of the collected variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">datacollector</span> <span class="o">=</span> <span class="n">DataCollector</span><span class="p">(</span><span class="n">agent_reporters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Wealth&quot;</span><span class="p">:</span> <span class="s2">&quot;wealth&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>We now simply tell the model to collect data with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">datacollector</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>each time we want to store values (<em>e.g.</em> right before or after we call <code class="docutils literal notranslate"><span class="pre">self.schedule.step()</span></code>).</p>
<p>Once the execution is finished, we can retrieve the data with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">datacollector</span><span class="o">.</span><span class="n">get_agent_vars_dataframe</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is a Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. See <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/frame.html">the Pandas documentation</a> for more information. You might also want to refer to <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html">the user guide</a> for information about Pandas’ data visualization.</p>
<p><strong>Question</strong></p>
<p>Add this data collector to your model and visualize the health value of one or several agents.</p>
</div>
<div class="section" id="model-level">
<h3>Model-level<a class="headerlink" href="#model-level" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to use functions in the collector. For example, assume we want to collect the value of the Gini Coefficient, a measure of wealth inequality, at each time step on the model. Let’s define the <code class="docutils literal notranslate"><span class="pre">compute_gini</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_gini</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">agent_wealths</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">wealth</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">agents</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">agent_wealths</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">num_agents</span>
    <span class="n">B</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">xi</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">xi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we can collect this data at runtime using the <code class="docutils literal notranslate"><span class="pre">DataCollector</span></code> with the parameter <code class="docutils literal notranslate"><span class="pre">model_reporters</span></code> set to a dictionary that associates the label of the data and the above function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">datacollector</span> <span class="o">=</span> <span class="n">DataCollector</span><span class="p">(</span>
    <span class="n">model_reporters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Gini&quot;</span><span class="p">:</span> <span class="n">compute_gini</span><span class="p">},</span>
    <span class="n">agent_reporters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Wealth&quot;</span><span class="p">:</span> <span class="s2">&quot;wealth&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>Note that we still collect the agents’ wealth values.</p>
<p><strong>Question</strong></p>
<p>Visualize the evolution of the Gini Coefficient in the simulation. What do you observe ?</p>
</div>
</div>
<div class="section" id="dynamic-visualization-optional">
<h2>2. Dynamic visualization (optional)<a class="headerlink" href="#dynamic-visualization-optional" title="Permalink to this headline">¶</a></h2>
<p>So far, we’ve built a model, run it, and analyzed some output afterwards. However, one of the advantages of agent-based models is that we can often watch them run step by step, potentially spotting unexpected patterns, behaviors or bugs, or developing new intuitions, hypotheses, or insights. Other times, watching a model run can explain it to an unfamiliar audience better than static explanations. Like many ABM frameworks, Mesa allows you to create an interactive visualization of the model. In this section we’ll walk through creating a visualization using built-in components.</p>
<p>First, a quick explanation of how Mesa’s interactive visualization works. Visualization is done in a browser window, using JavaScript to draw the different things being visualized at each step of the model. To do this, Mesa launches a small web server, which runs the model, turns each step into a JSON object (essentially, structured plain text) and sends those steps to the browser.</p>
<p>A visualization is built up of a few different modules: for example, a module for drawing agents on a grid, and another one for drawing a chart of some variable. Each module has a Python part, which runs on the server and turns a model state into JSON data; and a JavaScript side, which takes that JSON data and draws it in the browser window. Mesa comes with a few modules built in, and let you add your own as well.</p>
<div class="section" id="grid-visualization">
<h3>Grid Visualization<a class="headerlink" href="#grid-visualization" title="Permalink to this headline">¶</a></h3>
<p>To start with, let’s have a visualization where we can watch the agents moving around the grid. For this, you will need to put your model code in a separate Python source file; for example, <code class="docutils literal notranslate"><span class="pre">MoneyModel.py</span></code>. Next, either in the same file or in a new one (<em>e.g.</em> <code class="docutils literal notranslate"><span class="pre">MoneyModel_Viz.py</span></code>) import the server class and the <code class="docutils literal notranslate"><span class="pre">CanvasGrid</span></code> class (so-called because it uses HTML5 canvas to draw a grid). If you’re in a new file, you’ll also need to import the actual model object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mesa.visualization.modules</span> <span class="kn">import</span> <span class="n">CanvasGrid</span>
<span class="kn">from</span> <span class="nn">mesa.visualization.ModularVisualization</span> <span class="kn">import</span> <span class="n">ModularServer</span>

<span class="c1"># If MoneyModel.py is where your code is:</span>
<span class="c1"># from MoneyModel import MoneyModel</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CanvasGrid</span></code> works by looping over every cell in a grid, and generating a portrayal for every agent it finds. A portrayal is a dictionary (which can easily be turned into a JSON object) which tells the JavaScript side how to draw it. The only thing we need to provide is a function which takes an agent, and returns a portrayal object. Here’s the simplest one: it’ll draw each agent as a red, filled circle which fills half of each cell.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">agent_portrayal</span><span class="p">(</span><span class="n">agent</span><span class="p">):</span>
    <span class="n">portrayal</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Filled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Layer&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">portrayal</span>
</pre></div>
</div>
<p>In addition to the portrayal method, we instantiate a canvas grid with its width and height in cells, and in pixels. In this case, let’s create a 10 x 10 grid, drawn in 500 x 500 pixels.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">CanvasGrid</span><span class="p">(</span><span class="n">agent_portrayal</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we create and launch the actual server. We do this with the following arguments:</p>
<ul class="simple">
<li><p>The model class we’re running and visualizing; in this case, <code class="docutils literal notranslate"><span class="pre">MoneyModel</span></code>.</p></li>
<li><p>A list of module objects to include in the visualization; here, just <code class="docutils literal notranslate"><span class="pre">[grid]</span></code>.</p></li>
<li><p>The title of the model: <code class="docutils literal notranslate"><span class="pre">&quot;Money</span> <span class="pre">Model&quot;</span></code>.</p></li>
<li><p>Any inputs or arguments for the model itself. In this case, 100 agents, and height and width of 10.</p></li>
</ul>
<p>Once we create the server, we set the port for it to listen on (you can treat this as just a piece of the URL you’ll open in the browser). Finally, when you’re ready to run the visualization, use the server’s <code class="docutils literal notranslate"><span class="pre">launch()</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">ModularServer</span><span class="p">(</span><span class="n">MoneyModel</span><span class="p">,</span>
                   <span class="p">[</span><span class="n">grid</span><span class="p">],</span>
                   <span class="s2">&quot;Money Model&quot;</span><span class="p">,</span>
                   <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>
<span class="n">server</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">8521</span> <span class="c1"># The default</span>
<span class="n">server</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>
</div>
<p>The full code should now look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MoneyModel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mesa.visualization.modules</span> <span class="kn">import</span> <span class="n">CanvasGrid</span>
<span class="kn">from</span> <span class="nn">mesa.visualization.ModularVisualization</span> <span class="kn">import</span> <span class="n">ModularServer</span>

<span class="k">def</span> <span class="nf">agent_portrayal</span><span class="p">(</span><span class="n">agent</span><span class="p">):</span>
    <span class="n">portrayal</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Filled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Layer&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="s2">&quot;Color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">portrayal</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">CanvasGrid</span><span class="p">(</span><span class="n">agent_portrayal</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">ModularServer</span><span class="p">(</span><span class="n">MoneyModel</span><span class="p">,</span>
                       <span class="p">[</span><span class="n">grid</span><span class="p">],</span>
                       <span class="s2">&quot;Money Model&quot;</span><span class="p">,</span>
                       <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>
<span class="n">server</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">8521</span> <span class="c1"># The default</span>
<span class="n">server</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>
</div>
<p>Now run this file; this should launch the interactive visualization server and open your web browser automatically. (If the browser doesn’t open automatically, try pointing it at <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8521</span></code> manually. If this doesn’t show you the visualization, something may have gone wrong with the server launch.)</p>
<p>You should see something like the figure below: the model title, a grid filled with red circles representing agents, and a set of buttons to the right for running and resetting the model.</p>
<img alt="_images/viz_redcircles.png" class="align-center" src="_images/viz_redcircles.png" />
<ul class="simple">
<li><p>Click <code class="docutils literal notranslate"><span class="pre">step</span></code> to advance the model by one step, and the agents will move around.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">run</span></code> and the agents will keep moving around, at the rate set by the <code class="docutils literal notranslate"><span class="pre">fps</span></code> (frames per second) slider at the top. Try moving it around and see how the speed of the model changes.</p></li>
<li><p>Pressing <code class="docutils literal notranslate"><span class="pre">pause</span></code> will (as you’d expect) pause the model; pressing <code class="docutils literal notranslate"><span class="pre">run</span></code> again will restart it.</p></li>
<li><p>Finally, <code class="docutils literal notranslate"><span class="pre">reset</span></code> will start a new instantiation of the model.</p></li>
</ul>
<p>To stop the visualization server, go back to the terminal where you launched it, and press <code class="docutils literal notranslate"><span class="pre">Control+c</span></code>.</p>
</div>
<div class="section" id="changing-the-agents">
<h3>Changing the agents<a class="headerlink" href="#changing-the-agents" title="Permalink to this headline">¶</a></h3>
<p>In the visualization above, all we could see is the agents moving around – but not how much money they had, or anything else of interest. Let’s change it so that agents who are broke (wealth 0) are drawn in grey, smaller, and above agents who still have money.</p>
<p>To do this, we go back to our agent_portrayal code and add some code to change the portrayal based on the agent properties.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">agent_portrayal</span><span class="p">(</span><span class="n">agent</span><span class="p">):</span>
    <span class="n">portrayal</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Filled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">wealth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">portrayal</span><span class="p">[</span><span class="s2">&quot;Color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="n">portrayal</span><span class="p">[</span><span class="s2">&quot;Layer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">portrayal</span><span class="p">[</span><span class="s2">&quot;Color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span>
        <span class="n">portrayal</span><span class="p">[</span><span class="s2">&quot;Layer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">portrayal</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="k">return</span> <span class="n">portrayal</span>
</pre></div>
</div>
<p>Now launch the server again - this will open a new browser window pointed at the updated visualization. Initially it looks the same, but advance the model and smaller grey circles start to appear. Note that since the zero-wealth agents have a higher layer number, they are drawn on top of the red agents.</p>
<img alt="_images/viz_greycircles.png" class="align-center" src="_images/viz_greycircles.png" />
</div>
<div class="section" id="adding-a-chart">
<h3>Adding a chart<a class="headerlink" href="#adding-a-chart" title="Permalink to this headline">¶</a></h3>
<p>Next, let’s add another element to the visualization: a chart, tracking the model’s Gini Coefficient. This is another built-in element that Mesa provides.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mesa.visualization.modules</span> <span class="kn">import</span> <span class="n">ChartModule</span>
</pre></div>
</div>
<p>The basic chart pulls data from the model’s <code class="docutils literal notranslate"><span class="pre">DataCollector</span></code>, and draws it as a line graph using the <code class="docutils literal notranslate"><span class="pre">Charts.js</span></code> JavaScript libraries. We instantiate a chart element with a list of series for the chart to track. Each series is defined in a dictionary, and has a Label (which must match the name of a model-level variable collected by the <code class="docutils literal notranslate"><span class="pre">DataCollector</span></code>) and a <code class="docutils literal notranslate"><span class="pre">Color</span></code> name. We can also give the chart the name of the <code class="docutils literal notranslate"><span class="pre">DataCollector</span></code> object in the model.</p>
<p>Finally, we add the chart to the list of elements in the server. The elements are added to the visualization in the order they appear, so the chart will appear underneath the grid.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">ChartModule</span><span class="p">([{</span><span class="s2">&quot;Label&quot;</span><span class="p">:</span> <span class="s2">&quot;Gini&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Color&quot;</span><span class="p">:</span> <span class="s2">&quot;Black&quot;</span><span class="p">}],</span>
                    <span class="n">data_collector_name</span><span class="o">=</span><span class="s1">&#39;datacollector&#39;</span><span class="p">)</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">ModularServer</span><span class="p">(</span><span class="n">MoneyModel</span><span class="p">,</span>
                       <span class="p">[</span><span class="n">grid</span><span class="p">,</span> <span class="n">chart</span><span class="p">],</span>
                       <span class="s2">&quot;Money Model&quot;</span><span class="p">,</span>
                       <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>
</pre></div>
</div>
<p>Launch the visualization and start a model run, and you’ll see a line chart underneath the grid. Every step of the model, the line chart updates along with the grid. Reset the model, and the chart resets too.</p>
<img alt="_images/viz_chart.png" class="align-center" src="_images/viz_chart.png" />
</div>
<div class="section" id="user-settable-parameter">
<h3>User settable parameter<a class="headerlink" href="#user-settable-parameter" title="Permalink to this headline">¶</a></h3>
<p>The last part of the tutorial helps you to create a visualization interface in order to see the evolution of the ABM in the simulation. To allow faster modification of model parameters, it is possible to use <code class="docutils literal notranslate"><span class="pre">UserSettableParameter</span></code>. <code class="docutils literal notranslate"><span class="pre">UserSettableParameter</span></code> means that the user can modify this parameter in the web page. It takes 6 parameters (type, name, initial value, min value, max value, value per step).</p>
<p>Let’s start by importing the right mesa packages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mesa.visualization.modules</span> <span class="kn">import</span> <span class="n">CanvasGrid</span><span class="p">,</span> <span class="n">ChartModule</span><span class="p">,</span> <span class="n">TextElement</span>
<span class="kn">from</span> <span class="nn">mesa.visualization.UserParam</span> <span class="kn">import</span> <span class="n">UserSettableParameter</span>
</pre></div>
</div>
<p>Then, add the following line in the definition of the <code class="docutils literal notranslate"><span class="pre">ModularServer</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="n">UserSettableParameter</span><span class="p">(</span><span class="s2">&quot;slider&quot;</span><span class="p">,</span> <span class="s2">&quot;Agent density&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</pre></div>
</div>
<p>The call of the <code class="docutils literal notranslate"><span class="pre">ModularServer</span></code> became:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">ModularServer</span><span class="p">(</span><span class="n">MoneyModel</span><span class="p">,</span>
                   <span class="p">[</span><span class="n">grid</span><span class="p">,</span> <span class="n">chart</span><span class="p">],</span>
                   <span class="s2">&quot;Money Model&quot;</span><span class="p">,</span>
                   <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="n">UserSettableParameter</span><span class="p">(</span><span class="s2">&quot;slider&quot;</span><span class="p">,</span> <span class="s2">&quot;Agent density&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)})</span>
</pre></div>
</div>
<p><strong>Note:</strong> to be used in the visualization interface, the density should be define in the <code class="docutils literal notranslate"><span class="pre">MoneyModel</span></code>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.5. Optional features</a><ul>
<li><a class="reference internal" href="#collecting-data">1. Collecting data</a><ul>
<li><a class="reference internal" href="#agent-level">Agent-level</a></li>
<li><a class="reference internal" href="#model-level">Model-level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dynamic-visualization-optional">2. Dynamic visualization (optional)</a><ul>
<li><a class="reference internal" href="#grid-visualization">Grid Visualization</a></li>
<li><a class="reference internal" href="#changing-the-agents">Changing the agents</a></li>
<li><a class="reference internal" href="#adding-a-chart">Adding a chart</a></li>
<li><a class="reference internal" href="#user-settable-parameter">User settable parameter</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="part-3.html"
                        title="previous chapter">1.4. The Mesa platform for Python</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="correction-part-2.html"
                        title="next chapter">I.6. Exercise Solutions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/part-3-opt.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="correction-part-2.html" title="I.6. Exercise Solutions"
             >next</a> |</li>
        <li class="right" >
          <a href="part-3.html" title="1.4. The Mesa platform for Python"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MultiAgent Systems 2020-2021 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Emmanuel Hermellin, Wassila Ouerdane, Nicolas Sabouret.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>